<div class="relative">
  <!-- Game container -->
  <div  class="game md:flex md:gap-x-5"  :[ngClass]="{ 'opacity-30 blur-sm' : youwon || youlost}"> <!-- WHILE WE'RE IN GAME -->
      <!-- Our ships in positioning phase (or both our and enemy's ships during game phase)-->
      <div class="h-[480px] min-w-[266px] my-2">
        <!-- Available ships during positioning phase-->
        <div *ngIf="!gamestarted" class="mt-2 ml-2">
          <ul *ngFor="let placedship of this.placedShips; index as i">
            <li *ngIf="!placedship.isplaced">

              <div *ngIf="placedship.shiplength == 5 && placedship.remaining > 0 && !placedship.isselected" class="cursor-pointer" (click)="selectShip(5)"><!-- 5 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="120" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="160" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 5 && placedship.remaining > 0 && placedship.isselected" class="cursor-pointer" (click)="deselectShip()"><!-- 5 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="120" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="160" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 5 && placedship.remaining <= 0" style="opacity: 0.35"><!-- 5 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="120" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="160" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 4 && placedship.remaining > 0 && !placedship.isselected" class="cursor-pointer" (click)="selectShip(4)"><!-- 4 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="120" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 4 && placedship.remaining > 0 && placedship.isselected" class="cursor-pointer" (click)="deselectShip()"><!-- 4 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="120" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 4 && placedship.remaining <= 0" style="opacity: 0.35"><!-- 5 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="120" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 3 && placedship.remaining > 0 && !placedship.isselected" class="cursor-pointer" (click)="selectShip(3)"><!-- 3 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 3 && placedship.remaining > 0 && placedship.isselected" class="cursor-pointer" (click)="deselectShip()"><!-- 3 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 3 && placedship.remaining <= 0" style="opacity: 0.35"><!-- 5 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="80" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 2 && placedship.remaining > 0 && !placedship.isselected" class="cursor-pointer" (click)="selectShip(2)"><!-- 2 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 2 && placedship.remaining > 0 && placedship.isselected" class="cursor-pointer" (click)="deselectShip()"><!-- 2 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="green" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
              <div *ngIf="placedship.shiplength == 2 && placedship.remaining <= 0" style="opacity: 0.35"><!-- 5 cells long ship-->
                <span class="text-white">x{{ placedship.remaining}} remaining</span>
                <svg width="202px" height="42px">
                  <g >
                    <rect x="0" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="40" y="0" width="40" height="40" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
              </div>
            </li>
          </ul>
        </div>

        <!-- Representing our remaining ships during playing phase -->
        <div *ngIf="gamestarted" class="mt-2 ml-2">
          <span class="text-white"> Your remaining ships</span>
          <ul *ngFor="let placedship of this.placedShips; index as i">
            <li >
              <div *ngIf="placedship.shiplength == 5 && placedship.remaining > 0" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="127px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="100" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 5 && placedship.remaining <= 0" style="opacity: 0.35"  class="flex items-center"><!-- 5 cells long ship-->
                <svg width="127px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="100" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 4 && placedship.remaining > 0" class="flex items-center"><!-- 4 cells long ship-->
                <svg width="102px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 4 && placedship.remaining <= 0" style="opacity: 0.35" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="102px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 3 && placedship.remaining > 0" class="flex items-center"><!-- 3 cells long ship-->
                <svg width="77px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 3 && placedship.remaining <= 0" style="opacity: 0.35" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="77px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 2 && placedship.remaining > 0" class="flex items-center"><!-- 2 cells long ship-->
                <svg width="52px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
              <div *ngIf="placedship.shiplength == 2 && placedship.remaining <= 0" style="opacity: 0.35" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="502px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ placedship.remaining}}</span>
              </div>
            </li>
          </ul>
        </div>

        <!-- Representing enemy's remaining ships -->
        <div *ngIf="gamestarted" class="mt-5 ml-2">
          <span class="text-white"> {{enemy}}'s remaining ships</span>
          <ul *ngFor="let enemyship of this.enemyShips; index as i">
            <li>
              <div *ngIf="enemyship.shiplength == 5 && enemyship.remaining > 0" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="127px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="100" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 5 && enemyship.remaining <= 0" class="flex items-center opacity-30"><!-- 5 cells long ship-->
                <svg width="127px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="100" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 4 && enemyship.remaining > 0" class="flex items-center" class="flex items-center"><!-- 4 cells long ship-->
                <svg width="102px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 4 && enemyship.remaining <= 0" style="opacity: 0.35" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="102px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="75" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 3 && enemyship.remaining > 0" class="flex items-center" class="flex items-center"><!-- 3 cells long ship-->
                <svg width="77px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 3 && enemyship.remaining <= 0" style="opacity: 0.35" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="77px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="50" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 2 && enemyship.remaining > 0" class="flex items-center" class="flex items-center"><!-- 2 cells long ship-->
                <svg width="52px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#eae0c9" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
              <div *ngIf="enemyship.shiplength == 2 && enemyship.remaining <= 0" style="opacity: 0.35" class="flex items-center"><!-- 5 cells long ship-->
                <svg width="502px" height="27px">
                  <g >
                    <rect x="0" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                    <rect x="25" y="0" width="25" height="25" fill="#a61212" stroke="rgb(0, 0, 0)"/>
                  </g>
                </svg>
                <span class="text-white text-xxs">x{{ enemyship.remaining}}</span>
              </div>
            </li>
          </ul>
        </div>

        <!-- Timer partita -->
        <div *ngIf="gamestarted" class="mt-5 ml-2">
          <span *ngIf="timer != null && !myturn" class="text-white text-xs opacity-30">Enemy has {{timer}} seconds left</span>
          <span *ngIf="timer != null && myturn" class="text-white text-xs" :[ngClass]="{'text-red': timer <=4 }">You have {{timer}} seconds left</span>
        </div>

        <!-- Buttons only prematch -->
        <div *ngIf="!hasconfirmedpositioning" class="flex flex-col items-center justify-center gap-y-2 p-5 mt-6">
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted" class="btn text-xxs w-48 whitespace-nowrap" (click)="randomPlaceShips()">Random placement</button>
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted" class="btn text-xxs w-48" (click)="resetPlacement()">Reset</button>
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted && hasplacedallships" class="btn btn_green text-xxs w-48" (click)="confirmShipPlacement()">Confirm positioning</button>
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted && !hasplacedallships" class="btn btn_ylw text-xxs w-48" (click)="warnShipPlacement()">Confirm positioning</button>
          <span class="text-micro text-yellow-warning" *ngIf="warning != null">{{ warning }}</span>
        </div>
      </div>

      <!-- MYFIELD-->
      <div class="w-[480px] h-[480px] p-3">
        <p class="text-white mb-4">You</p>

        <div *ngFor="let row of myfield; index as y" class="grid grid-cols-10 bg-white">
          <div *ngFor="let cell of row; index as x" class="bg-white w-ful h-8">
            <div *ngIf="cell.value == -1" class="border border-black w-full h-full flex items-center justify-center">
              <span class="bg-black w-2 h-2 rounded-full"></span>
            </div>
            <div *ngIf="cell.value == 0 && !hasplacedallships && !hasconfirmedpositioning && selectedShip != 'none' && myfield[y][x].preview_success == 'none'" class="border border-black w-full h-full cursor-pointer" (mouseover)="checkPlaceableOnHover(x, y, selectedShip.length, selectedShip.orientation)" (wheel)="rotateSelectedShip(x, y, selectedShip.length, selectedShip.orientation)"></div> <!-- If we're still positioning ships -->
            <div *ngIf="cell.value == 0 && !hasplacedallships && !hasconfirmedpositioning && selectedShip != 'none' && myfield[y][x].preview_success == 'false'" class="border border-black bg-red-error w-full h-full cursor-pointer" (mouseover)="checkPlaceableOnHover(x, y, selectedShip.length, selectedShip.orientation)" (wheel)="rotateSelectedShip(x, y, selectedShip.length, selectedShip.orientation)"></div> <!-- If we're still positioning ships -->
            <div *ngIf="cell.value == 0 && !hasplacedallships && !hasconfirmedpositioning && selectedShip != 'none' && myfield[y][x].preview_success == 'true'" class="border border-black bg-success w-full h-full cursor-pointer" (mouseover)="checkPlaceableOnHover(x, y, selectedShip.length, selectedShip.orientation)" (wheel)="rotateSelectedShip(x, y, selectedShip.length, selectedShip.orientation)" (click)="placeShip(x, y, selectedShip.length, selectedShip.orientation)"></div> <!-- If we're still positioning ships -->
            <div *ngIf="cell.value == 0 && !hasconfirmedpositioning && selectedShip == 'none'" class="border border-black w-full h-full"></div> <!-- If we're still positioning ships -->
            <div *ngIf="cell.value == 0 && hasplacedallships && hasconfirmedpositioning" class="border border-black w-full h-full"></div>
            <div *ngIf="cell.value > 0 && !cell.hit && !hasconfirmedpositioning && selectedShip != 'none'" class="border border-black bg-sepia-lighter w-full h-full cursor-pointer" (click)="removeShip(x, y, cell.value, cell.orientation)" (mouseover)="checkPlaceableOnHover(x, y, selectedShip.length, selectedShip.orientation)" (wheel)="rotateSelectedShip(x, y, selectedShip.length, selectedShip.orientation)"></div>
            <div *ngIf="cell.value > 0 && !cell.hit && !hasconfirmedpositioning && selectedShip == 'none'" class="border border-black bg-sepia-lighter w-full h-full cursor-pointer" (click)="removeShip(x, y, cell.value, cell.orientation)"  (wheel)="rotateSelectedShip(x, y, selectedShip.length, selectedShip.orientation)"></div>
            <div *ngIf="cell.value > 0 && !cell.hit && hasconfirmedpositioning" class="border border-black bg-sepia-lighter w-full h-full"></div>
            <div *ngIf="cell.value != 0 && cell.hit" class="bg-sepia-lighter border border-red-error w-full h-full after:content-['\d7'] after:text-l after:flex after:items-center after:justify-center after:h-full after:text-red-error after:leading-none"></div>
          </div>
        </div>
      </div>

      <!-- ENEMYFIELD-->
      <div class="w-[480px] h-[480px] p-3" :[ngClass]="{'opacity-30': !myturn}">
        <p class="text-white mb-4">{{ enemy}}</p>

        <div *ngFor="let row of enemyfield; index as i" class="grid grid-cols-10 bg-white">
          <div *ngFor="let cell of row; index as j" class="bg-white w-full h-8 border border-black">
            <!-- <div *ngIf="cell.value != 0 && !cell.hit" class="bg-white w-full h-full"></div>
            <div *ngIf="cell.value != 0 && cell.hit" class="border border-error text-error w-full h-full">X</div> -->
            <div *ngIf="cell == '?' && myturn == true" class="w-full h-full">
              <button (click)="fire(i, j)" class="w-full h-full"></button>
            </div>
            <div *ngIf="cell == '?' && myturn == false" class="w-full h-full"></div>

            <div *ngIf="cell == 'water'" class="w-full h-full flex items-center justify-center">
              <span class="bg-black w-2 h-2 rounded-full"></span>
            </div>
            <div *ngIf="cell == 'hit'" class="w-full h-full after:content-['\d7'] after:text-l after:flex after:items-center after:justify-center after:h-full after:text-orange-400 after:leading-none"></div>
            <div *ngIf="cell == 'sunk'" class="w-full h-full after:content-['\d7'] after:text-l after:flex after:items-center after:justify-center after:h-full after:text-success after:leading-none"></div>
          </div>
        </div>
      </div>
      <!-- CHAT COMPONENT-->
      <div *ngIf="gamestarted == true" class="chat-live fixed bottom-0 right-1">
        <app-chat></app-chat>
      </div>
  </div>


  <!-- Final Buttons -->
  <div *ngIf="youlost && enemyleft" class="game absolute top-5 left-[37%] p-10 rounded-lg"> <!-- IF WE LOSE AND THE ENEMY  LEFT WE CAN'T ASK FOR A REMATCH -->
    <p class="text-xl font-bold text-white">You lost</p>
    <p class="text-m text-white">Enemy has left</p>
  </div>

  <div *ngIf="youlost && !enemyleft" class="game absolute top-5 left-[37%] p-10 rounded-lg"> <!-- IF WE LOSE AND THE ENEMY STILL HASN'T LEFT WE CAN STILL ASK FOR A REMATCH -->
    <p class="text-xl font-bold text-white mb-4">You lost</p>
    <div class="flex items-center justify-between gap-x-5">
      <button *ngIf="!this.enemywantsrematch" class="btn btn_green" (click)="askForRematch()">Ask for rematch</button>
      <button *ngIf="this.enemywantsrematch" class="btn btn_green" (click)="acceptRematch()">Accept rematch</button>
      <button class="btn btn_red" (click)="leaveMatch('enemyleftaftermatchended')">Leave</button>
    </div>
  </div>

  <div *ngIf="enemyleft && youwon" class="game absolute top-5 left-[37%] p-10 rounded-lg"> <!-- IF WE WON BECAUSE THE ENEMY LEFT -->
    <p class="text-xl font-bold text-white">You won
    <p class="text-m text-white">Your enemy left the match</p>
  </div>

  <div *ngIf="!enemyleft && youwon" class="game absolute top-5 left-[37%] p-10 rounded-lg"> <!-- IF WE WON AND THE ENEMY DIDN'T LEAVE THE MATCH -->
    <p class="text-xl font-bold text-white mb-4">You won</p>
    <div class="flex items-center justify-between gap-x-5">
      <button *ngIf="!this.enemywantsrematch" class="btn btn_green" (click)="askForRematch()">Ask for rematch</button>
      <button *ngIf="this.enemywantsrematch" class="btn btn_green" (click)="acceptRematch()">Accept rematch</button>
      <button class="btn btn_red" (click)="leaveMatch('enemyleftaftermatchended')" >Leave</button>
    </div>
  </div>

  <!-- Game buttons -->
  <div class="text-center pt-3">
    <button *ngIf="!gamestarted && !hasconfirmedpositioning && !youwon && !youlost && !enemyleft" class="btn btn_red" (click)="leaveMatch('enemyleftwhilepositioning')">Leave Match</button>
    <button *ngIf="gamestarted && !youwon && !enemyleft && !youlost" class="btn btn_red" (click)="leaveMatch('enemyleftwhileplaying')">Leave Match</button>
  </div>

</div>
