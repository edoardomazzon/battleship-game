<div class="mt-5">
  <!-- Game container -->
  <div *ngIf="enemyleft == false && youwon == false && youlost == false" class="game md:flex md:gap-x-5"> <!-- WHILE WE'RE IN GAME -->
      <!-- NAVI NOSTRE (o nemiche nella seconda fase)-->
      <div class="bg-gray-700 h-[480px]">
        <!-- Rappresentazioni navi disponibili nella fase di posizionamento (ogni nave scompare da questa lista quando Ã¨ posizionata) -->
        <div class="mt-2 ml-2">
          <p>[][][][][]</p>
          <p>[][][][]</p><p>[][][][]</p>
          <p>[][][]</p><p>[][][]</p>
          <p>[][]</p><p>[][]</p><p>[][]</p><p>[][]</p><p>[][]</p><p>[][]</p>
        </div>

        <!-- Rappresentazioni navi nostre durante partita (quindi dopo che entrambi hanno confermato il posizionamento)
             Navi verdi se sono vive, rosse se sono affondate -->
        <div class="navi-nostre"></div>

        <!-- Rappresentazioni navi nemici durante partita -->
        <div></div>

        <!-- Buttons only prematch -->
        <div *ngIf="!hasconfirmedpositioning" class="flex flex-col items-center justify-center gap-y-2 p-5">
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted" class="btn text-xxs w-48 whitespace-nowrap" (click)="randomPlaceShips()">Random placement</button>
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted" class="btn text-xxs w-48" (click)="resetPlacement()">Reset</button>
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted && hasplacedallships" class="btn !bg-success text-xxs w-48" (click)="confirmShipPlacement()">Confirm</button>
          <button *ngIf="!hasconfirmedpositioning && !youwon && !youlost && !gamestarted && !hasplacedallships" class="btn !bg-error text-xxs w-48" disabled>Confirm</button>
        </div>
      </div>

      <!-- MYFIELD-->
      <div class="w-[480px] h-[480px] p-3">
        <p class="text-white mb-4">You</p>

        <div *ngFor="let row of myfield; index as y" class="grid grid-cols-10 bg-white">
          <div *ngFor="let cell of row; index as x" class="bg-white w-ful h-8">
            <div *ngIf="cell.value == 0" class="border border-black w-full h-full"></div>
            <div *ngIf="cell.value != 0 && !cell.hit && !hasconfirmedpositioning" class="border border-black bg-sepia-lighter w-full h-full cursor-pointer" (click)="removeShip(x, y, cell.value, cell.orientation)"></div>
            <div *ngIf="cell.value != 0 && !cell.hit && hasconfirmedpositioning" class="border border-black bg-sepia-lighter w-full h-full"></div>
            <div *ngIf="cell.value != 0 && cell.hit" class="border border-red text-red text-bold w-full h-full text-center justify-center">
              <span class="text-bold text-base text-red">X</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ENEMYFIELD-->
      <div class="w-[480px] h-[480px] p-3">
        <p class="text-white mb-4">{{ enemy}}</p>

        <div *ngFor="let row of enemyfield; index as i" class="grid grid-cols-10 bg-white">
          <div *ngFor="let cell of row; index as j" class="bg-white w-full h-8 border border-black">
            <!-- <div *ngIf="cell.value != 0 && !cell.hit" class="bg-navy w-full h-full"></div>
            <div *ngIf="cell.value != 0 && cell.hit" class="border border-error text-error w-full h-full">X</div> -->
            <span *ngIf="cell == '?' && myturn == true" class="w-full h-full">
              <button (click)="fire(i, j)" class="w-full h-full"></button>
            </span>
            <span *ngIf="cell == '?' && myturn == false" class="w-full h-full"></span>

            <div *ngIf="cell == 'water'" class="w-full h-full bg-gray-300 flex items-center justify-center text-white"><span>.</span></div>
            <span *ngIf="cell == 'hit'" class="w-full h-full">/</span>
            <div *ngIf="cell == 'sunk'" class="border border-success text-success text-bold w-full h-full text-center justify-center">
              <span class="text-bold text-base text-success">X</span>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-live ml-8"> <!-- CHAT COMPONENT-->
        <div class="bg-gray-300 h-[480px] w-[300px]">
          <div *ngIf="gamestarted == true">
            <app-chat></app-chat>
          </div>
      </div>
      </div>
  </div>


  <!-- Final Buttons -->
  <div *ngIf="youlost && enemyleft" class="game md:flex w-3/4"> <!-- IF WE LOSE AND THE ENEMY  LEFT WE CAN'T ASK FOR A REMATCH -->
    <p>YOU LOST - Enemy has left</p>
  </div>

  <div *ngIf="youlost && !enemyleft" class="game md:flex w-3/4"> <!-- IF WE LOSE AND THE ENEMY STILL HASN'T LEFT WE CAN STILL ASK FOR A REMATCH -->
    <p> YOU LOST</p>
    <button *ngIf="!this.enemywantsrematch" class="btn" (click)="askForRematch()">Ask for rematch</button>
    <button *ngIf="this.enemywantsrematch" class="btn" (click)="acceptRematch()">Accept rematch</button>
    <button class="btn" (click)="leaveMatch('enemyleftaftermatchended')" >Leave</button>
  </div>

  <div *ngIf="enemyleft && youwon" class="game md:flex w-3/4"> <!-- IF WE WON BECAUSE THE ENEMY LEFT -->
    <p> YOU WON - Your enemy left the match</p>
  </div>

  <div *ngIf="!enemyleft && youwon" class="game md:flex w-3/4"> <!-- IF WE WON AND THE ENEMY DIDN'T LEAVE THE MATCH -->
    <p> YOU WON</p>
    <button *ngIf="!this.enemywantsrematch" class="btn" (click)="askForRematch()">Ask for rematch</button>
    <button *ngIf="this.enemywantsrematch" class="btn" (click)="acceptRematch()">Accept rematch</button>
    <button class="btn" (click)="leaveMatch('enemyleftaftermatchended')" >Leave</button>
  </div>

  <!-- Game buttons -->
  <div>
    <button *ngIf="!gamestarted && !hasconfirmedpositioning && !youwon && !youlost && !enemyleft" class="btn" (click)="leaveMatch('enemyleftwhilepositioning')">Leave Match</button>
    <button *ngIf="gamestarted && !youwon && !enemyleft && !youlost" class="btn" (click)="leaveMatch('enemyleftwhileplaying')">Leave Match</button>
  </div>
</div>
